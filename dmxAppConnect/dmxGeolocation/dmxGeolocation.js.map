{"version":3,"sources":["components/geolocation.js"],"names":["dmx","Component","initialData","support","navigator","geolocation","status","timestamp","coords","attributes","tracking","type","Boolean","default","enableHighAccuracy","maxAge","Number","timeout","methods","getCurrentPosition","this","_getCurrentPosition","watchPosition","_watchPosition","clearWatch","_clearWatch","events","success","Event","error","permissiondenied","unavailable","errorCodes","render","init","node","_successHandler","bind","_errorHandler","props","performUpdate","updatedProps","data","supprt","has","maximumAge","_watching","pos","set","latitude","longitude","altitude","accuracy","altitudeAccuracy","heading","speed","nextTick","dispatchEvent","err","message","code"],"mappings":";;;;;;AAAAA,IAAAC,UAAA,cAAA,CAEAC,YAAA,CACAC,UAAAC,UAAAC,YACAC,OAAAF,UAAAC,YACA,gDACA,cACAE,UAAA,KACAC,OAAA,MAGAC,WAAA,CACAC,SAAA,CACAC,KAAAC,QACAC,SAAA,GAGAC,mBAAA,CACAH,KAAAC,QACAC,SAAA,GAGAE,OAAA,CACAJ,KAAAK,OACAH,QAAA,KAGAI,QAAA,CACAN,KAAAK,OACAH,QAAA,OAIAK,QAAA,CACAC,qBACAC,KAAAC,qBACA,EAEAC,gBACAF,KAAAG,gBACA,EAEAC,aACAJ,KAAAK,aACA,GAGAC,OAAA,CACAC,QAAAC,MACAC,MAAAD,MACAE,iBAAAF,MACAG,YAAAH,MACAX,QAAAW,OAGAI,WAAA,CACA,EAAA,mBACA,EAAA,cACA,EAAA,WAGAC,QAAA,EAEAC,KAAAC,GACAf,KAAAgB,gBAAAhB,KAAAgB,gBAAAC,KAAAjB,MACAA,KAAAkB,cAAAlB,KAAAkB,cAAAD,KAAAjB,MAEAA,KAAAmB,MAAA7B,SACAU,KAAAG,iBAEAH,KAAAC,qBAEA,EAEAmB,cAAAC,GACArB,KAAAsB,KAAAC,QAEAF,EAAAG,IAAA,cACAxB,KAAAmB,MAAA7B,SACAU,KAAAG,iBAEAH,KAAAK,cAGA,EAEAJ,sBACAD,KAAAsB,KAAAvC,SAEAC,UAAAC,YAAAc,mBACAC,KAAAgB,gBACAhB,KAAAkB,cACA,CACAxB,mBAAAM,KAAAmB,MAAAzB,mBACAG,QAAAG,KAAAmB,MAAAtB,QACA4B,WAAAzB,KAAAmB,MAAAxB,QAGA,EAEAQ,iBACAH,KAAAsB,KAAAvC,UAAAiB,KAAA0B,YAEA1B,KAAA0B,UAAA1C,UAAAC,YAAAiB,cACAF,KAAAgB,gBACAhB,KAAAkB,cACA,CACAxB,mBAAAM,KAAAmB,MAAAzB,mBACAG,QAAAG,KAAAmB,MAAAtB,QACA4B,WAAAzB,KAAAmB,MAAAxB,SAGA,EAEAU,cACAL,KAAAsB,KAAAvC,SAAAiB,KAAA0B,YAEA1C,UAAAC,YAAAmB,WAAAJ,KAAA0B,kBACA1B,KAAA0B,UACA,EAEAV,gBAAAW,GACA3B,KAAA4B,IAAA,SAAA,MACA5B,KAAA4B,IAAA,YAAAD,EAAAxC,WACAa,KAAA4B,IAAA,SAAA,CACAC,SAAAF,EAAAvC,OAAAyC,SACAC,UAAAH,EAAAvC,OAAA0C,UACAC,SAAAJ,EAAAvC,OAAA2C,SACAC,SAAAL,EAAAvC,OAAA4C,SACAC,iBAAAN,EAAAvC,OAAA6C,iBACAC,QAAAP,EAAAvC,OAAA8C,QACAC,MAAAR,EAAAvC,OAAA+C,QAGAvD,IAAAwD,UAAA,IAAApC,KAAAqC,cAAA,YACA,EAEAnB,cAAAoB,GACAtC,KAAA4B,IACA,SACAU,EAAAC,SAAAvC,KAAAY,WAAA0B,EAAAE,OAAA,kBAGA5D,IAAAwD,UAAA,IAAApC,KAAAqC,cAAArC,KAAAY,WAAA0B,EAAAE,OAAA,UACA","file":"dmxGeolocation.js","sourcesContent":["dmx.Component(\"geolocation\", {\r\n\r\n  initialData: {\r\n    support: !!navigator.geolocation,\r\n    status: navigator.geolocation\r\n      ? \"Geolocation is not supported by this browser.\"\r\n      : \"Locating...\",\r\n    timestamp: null,\r\n    coords: null, // { latitude, longitude, altitude, accuracy, altitudeAccuracy, heading, speed }\r\n  },\r\n\r\n  attributes: {\r\n    tracking: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    enableHighAccuracy: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    maxAge: {\r\n      type: Number,\r\n      default: 30000,\r\n    },\r\n\r\n    timeout: {\r\n      type: Number,\r\n      default: 27000,\r\n    },\r\n  },\r\n\r\n  methods: {\r\n    getCurrentPosition () {\r\n      this._getCurrentPosition();\r\n    },\r\n\r\n    watchPosition () {\r\n      this._watchPosition();\r\n    },\r\n\r\n    clearWatch () {\r\n      this._clearWatch();\r\n    },\r\n  },\r\n\r\n  events: {\r\n    success: Event,\r\n    error: Event,\r\n    permissiondenied: Event,\r\n    unavailable: Event,\r\n    timeout: Event,\r\n  },\r\n\r\n  errorCodes: {\r\n    1: \"permissiondenied\",\r\n    2: \"unavailable\",\r\n    3: \"timeout\",\r\n  },\r\n\r\n  render: false,\r\n\r\n  init (node) {\r\n    this._successHandler = this._successHandler.bind(this);\r\n    this._errorHandler = this._errorHandler.bind(this);\r\n\r\n    if (this.props.tracking) {\r\n      this._watchPosition();\r\n    } else {\r\n      this._getCurrentPosition();\r\n    }\r\n  },\r\n\r\n  performUpdate (updatedProps) {\r\n    if (!this.data.supprt) return;\r\n\r\n    if (updatedProps.has(\"tracking\")) {\r\n      if (this.props.tracking) {\r\n        this._watchPosition();\r\n      } else {\r\n        this._clearWatch();\r\n      }\r\n    }\r\n  },\r\n\r\n  _getCurrentPosition () {\r\n    if (!this.data.support) return;\r\n\r\n    navigator.geolocation.getCurrentPosition(\r\n      this._successHandler,\r\n      this._errorHandler,\r\n      {\r\n        enableHighAccuracy: this.props.enableHighAccuracy,\r\n        timeout: this.props.timeout,\r\n        maximumAge: this.props.maxAge,\r\n      }\r\n    );\r\n  },\r\n\r\n  _watchPosition () {\r\n    if (!this.data.support || this._watching) return;\r\n    \r\n    this._watching = navigator.geolocation.watchPosition(\r\n      this._successHandler,\r\n      this._errorHandler,\r\n      {\r\n        enableHighAccuracy: this.props.enableHighAccuracy,\r\n        timeout: this.props.timeout,\r\n        maximumAge: this.props.maxAge,\r\n      }\r\n    );\r\n  },\r\n\r\n  _clearWatch () {\r\n    if (!this.data.support || !this._watching) return;\r\n\r\n    navigator.geolocation.clearWatch(this._watching);\r\n    delete this._watching;\r\n  },\r\n\r\n  _successHandler (pos) {\r\n    this.set(\"status\", \"OK\");\r\n    this.set(\"timestamp\", pos.timestamp);\r\n    this.set(\"coords\", {\r\n      latitude: pos.coords.latitude,\r\n      longitude: pos.coords.longitude,\r\n      altitude: pos.coords.altitude,\r\n      accuracy: pos.coords.accuracy,\r\n      altitudeAccuracy: pos.coords.altitudeAccuracy,\r\n      heading: pos.coords.heading,\r\n      speed: pos.coords.speed,\r\n    });\r\n\r\n    dmx.nextTick(() => this.dispatchEvent('success'));\r\n  },\r\n\r\n  _errorHandler (err) {\r\n    this.set(\r\n      \"status\",\r\n      err.message || this.errorCodes[err.code] || \"Unknown Error.\"\r\n    );\r\n\r\n    dmx.nextTick(() => this.dispatchEvent(this.errorCodes[err.code] || \"error\"));\r\n  }\r\n\r\n});\r\n"]}